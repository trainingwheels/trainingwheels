# upstart script for TrainingWheels sentinel
description "start and stop the TrainingWheels sentinel server."
version "0.1"
author "Four Kitchens"

expect daemon

env SENTINEL_HOME={{ twdir }}/sentinel
export SENTINEL_HOME

# start after all filesystems & network interfae are available
start on (local-filesystems and net-device-up IFACE!=lo)
stop on runlevel [!2345]

pre-start script
  chdir $SENTINEL_HOME
  exec /usr/bin/npm install
end script

script
  exec /usr/bin/forever -a -l /var/log/forever.log -o /var/log/tw-sentinel.log -e /var/log/tw-sentinel.error.log start $SENTINEL_HOME/app.js 2>&1
end script

pre-stop script
  exec /usr/bin/forever stop $SENTINEL_HOME/app.js
end script
